import time #imports
import board
import digitalio
import adafruit_mpl3115a2
import busio

button = digitalio.DigitalInOut(board.GP16) #adds in the button
button.direction = digitalio.Direction.INPUT
button.pull = digitalio.Pull.UP #incorperates the button into the circuit
sda_pin = board.GP0  #sets up i2c
scl_pin = board.GP1
i2c = busio.I2C(scl_pin, sda_pin)
sensor = adafruit_mpl3115a2.MPL3115A2(i2c) 

time_list = []
altitude_list = []  #sets up lists
temperature_list = []
new_data = 0

while True: #if the button/switch is pressed this will happen
     if button.value == False:
         if new_data == 0:
            data_time = time.monotonic()
            new_data = 1
         print("taking data")
         print(time.monotonic()-data_time)
         altitude = sensor.altitude #read altitude
         altitude_list.append(sensor.altitude)
         #print("Altitude: {0:0.3f} meters".format(altitude)) #print altitude readings
         temperature = sensor.temperature
         temperature_list.append(sensor.temperature) #saves values for collection later
         #print("Temperature: {0:0.3f} degrees Celsius".format(temperature))
         time_list.append(time.monotonic())
         #time.sleep(1.0)
         
         #if altitude[-1]-altitude[-30]<2 and time.monotonic()>800:  #when the altimeter readings stop changing
         if time.monotonic()-data_time>30:
            if altitude_list[-1]-altitude_list[-10]<2:
               break   #stop code taking values

         
#store data to pico in csv


with open("/data.txt", "a") as datalog:
        for i in range(len(time_list)):
            input_values = f" {time[i]}, {altitude[i]}, {temperature[i]}"
            datalog.write('{0:f}\n'.format(input_values))  #save all time, altitude, temperature values in seperate lines in pico
            datalog.flush()
